# Contracts

There are 3 main contracts: Zapper, DeFindex and Strategy (formerly known as Adapter). 

## Zapper
This contract enables users to invest in and withdraw from a DeFindex using a single asset. For instance, if a DeFindex requires both USDC and XLM, the Zapper contract allows users to deposit USDC, automatically swapping the USDC for XLM and depositing both assets into the DeFindex according to a predefined ratio. Similarly, the Zapper contract facilitates withdrawals by swapping the XLM back to USDC before returning the funds to the user.

The specific paths used for asset swaps, as well as the proportion of the output assets, are determined off-chain.

This contract serves as the core of the DeFindex platform, responsible for managing assets, executing strategies, and ensuring proper asset rebalancing. It operates with three primary roles: Deployer, Manager, and Emergency Manager. Additionally, the contract functions as a token, similar to a liquidity pool token, referred to as the dfToken.

While anyone can invest in a DeFindex, only the Manager and Emergency Manager have the authority to move funds between the DeFindex and its associated strategies.

The contract also holds funds not currently invested in any strategy, known as IDLE funds. These funds act as a safety buffer, allowing the Emergency Manager to withdraw assets from underperforming strategies and store them as IDLE funds.

Key functions of the contract include balance retrieval, and investment and withdrawal operations from the strategies.

Rebalancing is managed by the Manager, who can shift funds from one strategy to another, thereby adjusting the proportions of the underlying assets. For example, the Deployer might initially set a ratio of 2 USDC to 1 XLM for a DeFindex, but this ratio can change based on strategy yields or rebalancing actions by the Manager.

When a DeFindex is deployed, the Deployer sets the strategies and the initial proportion of underlying assets. The Manager can later modify these proportions in response to changing conditions.

Strategies are required to report the amount of underlying assets they hold, ensuring that when shares of the DeFindex liquidity pool token are minted, they reflect the correct asset proportions.

### Fee Collection
The revenues generated by the strategies are collected as shares of the DeFindex. The initial setup recommends a fee of 1%-2% APR on these shares. For instance, if a DeFindex has 100 shares and the fee is set at 1% APR, the fees collected would be 1 share annually.

The distribution of the collected shares is as follows: 50% to **palta**labs, 30% to the Manager, and 20% to the Strategy developers, proportionally allocated based on the underlying assets. These allocations are recalculated whenever a user deposits or withdraws from the DeFindex or when rebalancing occurs.

## Strategy
This contract is responsible for generating yields for the DeFindex. It provides key functions such as deposit, withdraw, and balance.

The strategy itself is a `struct` that can be implemented by other developers. This can include DeFi protocol developers or anyone with a compelling strategy designed to generate yields.